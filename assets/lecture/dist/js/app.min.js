!function(){"use strict";angular.module("suli",["ui.router","suli.main","suli.webrtc","suli.chat","suli.whiteboard"])}(),function(){"use strict";function a(a,b,c){c.html5Mode({enabled:!0,requireBase:!1}),b.otherwise("/"),a.state("layout",{templateUrl:"app/modules/main/views/main.html",controller:"MainController"}).state("layout.main",{url:"/",views:{webrtc:{templateUrl:"app/modules/webrtc/views/video.html",controller:"WebrtcController"},chat:{templateUrl:"app/modules/chat/views/chat.html",controller:"ChatController"},whiteboard:{templateUrl:"app/modules/whiteboard/views/whiteboard.html",controller:"WhiteBoardController"}}})}angular.module("suli").config(["$stateProvider","$urlRouterProvider","$locationProvider",a])}(),function(){"use strict";angular.module("suli.chat",["ui.router","angularMoment"])}(),function(){"use strict";angular.module("suli.chat").controller("ChatController",["$scope","$state","moment","$http",function(a,b,c,d){function e(){$("#MessageList").animate({scrollTop:$("#MessageList")[0].scrollHeight},500)}a.messages=[],a.message="",a.socketId=prortc.selfSocketId,setTimeout(function(){a.socketId=prortc.selfSocketId},2e3),prortc.on("message",function(b){a.socketId=prortc.selfSocketId,a.$apply(function(){a.messages.push(b.message),e()})}),a.send=function(){if(""!==a.message){var b={content:a.message,created_at:new Date,type:"text",socketId:prortc.otherSocketId};a.messages.push(b),prortc.socket.emit("message",b),prortc.sendMessage(b),a.message="",e()}},a.keyPressSend=function(b){13==b.keyCode&&a.send()},a.selectFile=function(){angular.element("#file").click()},a.shareFile=function(b){var c=new FormData;c.append("file",b.files[0]),d.post("https://suli.prortc.com/upload",c,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(b){if(b.data.success){var c={filePath:"https://suli.prortc.com/"+b.data.filePath,fileName:b.data.filename,type:"file",created_at:new Date,socketId:prortc.otherSocketId};a.messages.push(c),prortc.socket.emit("message",c)}},function(a){console.log("File upload error->",a)})}}])}(),function(){"use strict";angular.module("suli.webrtc",["ui.router"])}(),function(){"use strict";function a(){var a,b=window.prortc;return{connect:function(c,d){d.room&&(b.init(c),a=d,b.joinRoom(a))},startCall:function(a){b.startCall({video:!0,audio:!0},function(b){a(b)},function(b){a(!1)})},getSocket:function(){return b.socket},getSocketIds:function(){return b.sockets}}}angular.module("suli.webrtc").factory("WebrtcService",[a])}(),function(){"use strict";angular.module("suli.webrtc").controller("WebrtcController",["$scope","$rootScope","$state","moment","WebrtcService",function(a,b,c,d,e){function f(){a.courseTimer||(a.courseTimer=d.duration(1,"seconds").timer({loop:!0},function(){a.$apply(function(){a.secondsFromStart++,a.secondsLeft--,prortc.socket.emit("sync_time",{secondsLeft:a.secondsLeft,secondsFromStart:a.secondsFromStart}),a.secondsLeft<0&&g()})}))}function g(){prortc.endCall(),a.courseTimer&&a.courseTimer.stop(),a.isStopped=!0,prortc.emit("course_ended")}angular.element('[data-toggle="tooltip"]').tooltip(),a.videoClass="glyph-icon flaticon-video-1",a.audioClass="glyph-icon flaticon-microphone",a.isSwitch=1,a.audioToggle=function(){"glyph-icon flaticon-microphone"===a.audioClass?a.audioClass="glyph-icon flaticon-muted":a.audioClass="glyph-icon flaticon-microphone",prortc.muteAudioToggle()},a.changeSwitch=function(a){prortc.emit("tutor_switch_whiteboard",{allowStudent:a}),prortc.socket.emit("allow_student",{allowStudent:a})},a.videoToggle=function(){"glyph-icon flaticon-video-1"===a.videoClass?a.videoClass="glyph-icon flaticon-no-video":a.videoClass="glyph-icon flaticon-video-1",prortc.muteVideoToggle()},a.courseTimer,a.secondsFromStart=0,a.secondsLeft=3600,a.isStopped=!1,a.isPeerDisconnected=!1,a.isCallRunning=!1,a.isOtherConnected=!1,a.intervalObjects=[],prortc.on("start_call",function(b){e.connect("https://suli.prortc.com/",b),"tutor"===b.role&&(a.secondsLeft=3600*b.noOfCourses,prortc.noOfCourses=b.noOfCourses,prortc.socket.emit("no_of_courses",{noOfCourses:b.noOfCourses})),prortc.userRole=b.role,e.startCall(function(b){"student"===prortc.userRole&&a.$apply(function(){a.secondsLeft=3600*prortc.noOfCourses}),b&&prortc.attachStream(b,"local")})}),prortc.on("start_timer",function(){f()}),prortc.on("new_updated_time",function(b){console.log("new_updated_time",b),prortc.socket.emit("end_updated_time"),a.$apply(function(){a.secondsLeft=b.secondsLeft})}),prortc.on("end_updated_time",function(b){console.log("end_updated_time",b);var c=a.intervalObjects.length;console.log("end_updated_time",a.intervalObject),setTimeout(function(){if(c>0)for(var b=0;b<c;b++)clearInterval(a.intervalObjects[b])},2e3),a.courseTimer&&a.courseTimer.start()}),prortc.on("update_course",function(b){console.log("update_course",b),a.isPeerDisconnected||a.$apply(function(){prortc.noOfCourses=b.noOfCourses,a.secondsLeft=3600*b.noOfCourses})}),prortc.on("course_ended",function(){console.log("course ended"),setTimeout(function(){a.secondsLeft=0,a.courseTimer&&a.courseTimer.stop()},1e3)}),a.secondsToHHMMSS=function(b){var c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;c<10&&(c="0"+c),d<10&&(d="0"+d),e<10&&(e="0"+e);var f=c+":"+d+":"+e;return a.isStopped&&(f="00:00:00"),angular.element("#time").html(f),f},prortc.on("remote_stream",function(b,c){prortc.attachStream(b,"remote"),a.isStopped=!1,a.isCallRunning=!0,a.isOtherConnected=!0,a.isPeerDisconnected=!1,a.courseTimer&&a.courseTimer.start()}),prortc.on("disconnected_peer",function(b){console.log("disconnected dddd"),prortc.detachStream("remote"),a.courseTimer&&(a.isPeerDisconnected=!0,a.courseTimer.stop());var c=setInterval(function(){prortc.socket.emit("update_time",{secondsLeft:a.secondsLeft,noOfCourses:prortc.noOfCourses})},1e3);a.intervalObjects.push(c),a.$emit("user_left")}),prortc.on("disconnected_peer_wihtout_media",function(b){console.log("disconnected without media"),a.courseTimer&&(a.isPeerDisconnected=!0,a.courseTimer.stop());var c=setInterval(function(){prortc.socket.emit("update_time",{secondsLeft:a.secondsLeft,noOfCourses:prortc.noOfCourses})},1e3);a.intervalObjects.push(c),a.$emit("user_left")}),prortc.on("extend_my_time",function(b){a.secondsLeft=parseInt(a.secondsLeft,10)+parseInt(b.time,10)}),prortc.on("extend_time_accepted",function(b){a.secondsLeft=parseInt(a.secondsLeft,10)+parseInt(b.message.time,10)})}])}(),function(){"use strict";angular.module("suli.whiteboard",["ui.router","suli.webrtc"])}(),function(){"use strict";function a(a){function b(){h.isDrawingMode=!1,h.off("mouse:down"),h.off("mouse:move"),h.off("mouse:up"),h.off("object:selected")}function c(a){try{h&&(console.log(j[a]),h.loadFromJSON(j[a],h.renderAll.bind(h),function(a,b){b.id=a.id}),m?k.setSelectable(!0):k.setSelectable(!1),h.forEachObject(function(a){a.selectable=m}),h.selectable=m,h.renderAll.bind(h),console.log("isWritable",m,h.selectable))}catch(a){console.log("error on loadHistoryStateByIndex =>",a)}}function d(){-1!=i&&(j=j.slice(0,i+1)),j.push(h.toJSON(["id"])),i=j.length-1}function e(){for(var b=a.getSocketIds(),c=b.length,d=0,e=c;d<e;d++){var f=b[d];prortc.sendMessage({type:"whiteboard",socketId:f,canvasJson:{historyStates:j,currentHistoryState:i}})}}function f(){d(),e()}function g(a){for(var b=h.getObjects(),c=h.getObjects().length,d=0;d<c;d++)if(b[d].id==a||b[d].id=="NaN"+a)return b[d]}var h,i=-1,j=[],k=this,l="",m=!0,n=!1;k.init=function(b){h=new fabric.Canvas(b),h.renderOnAddRemove=!1,h.setBackgroundColor("rgba(255, 255, 255, 1)",h.renderAll.bind(h)),h.on("object:modified",function(b){var c=b.target.toJSON(["id"]);console.log("object:modified id before ",c.id),a.getSocket().emit("object:modified",c),d()}),h.on("object:added",function(a){}),h.on("object:removed",function(b){console.log("object:removed",b.target),a.getSocket().emit("object:removed",b.target.toJSON(["id"])),d()}),h.on("path:created",function(b){b.path.id=k.generateId(),a.getSocket().emit("path:created",b.path.toJSON(["id"])),d()})},k.setUserRole=function(a){l=a},k.setMinimize=function(a){n=a},k.setWritable=function(a){m=a},k.getMinimize=function(){return n},k.getWritable=function(){return m},k.getCanvas=function(){return h},k.generateId=function(){return function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}()},k.setSelectable=function(a){a||b(),h.selectable=a,h.forEachObject(function(b){b.selectable=a})},k.setRemoteStates=function(a){try{j=a.canvasData.historyStates,i=a.canvasData.currentHistoryState,c(i)}catch(a){console.log("remote states error =>",a)}},k.setSize=function(a,b,c){var c=a/h.getWidth(),d=b/h.getHeight();h.setWidth(h.getWidth()*c),h.setHeight(h.getHeight()*d);var e=h.getObjects();for(var f in e){var g=e[f].scaleX,i=e[f].scaleY,j=e[f].left,k=e[f].top,l=g*c,m=i*d,n=j*c,o=k*d;e[f].scaleX=l,e[f].scaleY=m,e[f].left=n,e[f].top=o,e[f].setCoords()}h.renderAll(),h.calcOffset()},k.addText=function(c){var d,e,f,g;b(),h.on("mouse:down",function(a){var b=h.getPointer(a.e);d=b.x,e=b.y}),h.on("mouse:up",function(i){var j=h.getPointer(i.e);f=j.x,g=j.y;var l=new fabric.Textbox(c,{left:d,top:e,width:f-d,height:g-e,fill:h.freeDrawingBrush.color});l.id=k.generateId(),h.add(l),a.getSocket().emit("object:added",l.toJSON(["id"])),b()})},k.undo=function(){b(),-1==i?i=j.length-2:i--,i<0&&(i=0),c(i),e()},k.redo=function(){b(),-1==i?i=j.length-1:i++,i>=j.length&&(i=j.length-1),c(i),e()},k.changeColor=function(a){b(),h.freeDrawingBrush.color=a},k.enableDrawing=function(a){b(),h.isDrawingMode=!0,h.freeDrawingBrush.width=a,h.freeDrawingBrush.id=k.generateId()},k.selectTool=function(){b()},k.addLine=function(){var c,d;b(),h.on("mouse:down",function(a){h.selection=!1,c=!0;var b=h.getPointer(a.e),e=[b.x,b.y,b.x,b.y];d=new fabric.Line(e,{strokeWidth:5,stroke:h.freeDrawingBrush.color,originX:"center",originY:"center",id:k.generateId()}),h.add(d)}),h.on("mouse:move",function(a){if(c){var b=h.getPointer(a.e);d.set({x2:b.x,y2:b.y}),h.renderAll()}}),h.on("mouse:up",function(e){c=!1,d.setCoords(),b(),h.trigger("object:added",{target:d}),a.getSocket().emit("object:added",d.toJSON(["id"]))})},k.addSquare=function(){var c,d,e,f;b(),h.on("mouse:down",function(a){h.selection=!1,d=!0;var b=h.getPointer(a.e);e=b.x,f=b.y,b=h.getPointer(a.e),c=new fabric.Rect({left:e,top:f,originX:"left",originY:"top",width:b.x-e,height:b.y-f,angle:0,fill:"rgba(0,0,0,0)",stroke:h.freeDrawingBrush.color,strokeWidth:2,transparentCorners:!1,id:k.generateId()}),c.id=k.generateId(),h.add(c)}),h.on("mouse:move",function(a){if(d){var b=h.getPointer(a.e);e>b.x&&c.set({left:Math.abs(b.x)}),f>b.y&&c.set({top:Math.abs(b.y)}),c.set({width:Math.abs(e-b.x)}),c.set({height:Math.abs(f-b.y)}),h.renderAll()}}),h.on("mouse:up",function(e){d=!1,c.setCoords(),b(),h.trigger("object:added",{target:c}),a.getSocket().emit("object:added",c.toJSON(["id"]))})},k.addTriangle=function(){var c,d,e,f;b(),h.on("mouse:down",function(a){h.selection=!1,d=!0;var b=h.getPointer(a.e);e=b.x,f=b.y,c=new fabric.Triangle({left:b.x,top:b.y,strokeWidth:2,width:2,height:2,stroke:h.freeDrawingBrush.color,fill:"rgba(0,0,0,0)",selectable:!0,originX:"center",id:k.generateId()}),h.add(c)}),h.on("mouse:move",function(a){if(d){var b=h.getPointer(a.e);c.set({width:Math.abs(e-b.x),height:Math.abs(f-b.y)}),h.renderAll()}}),h.on("mouse:up",function(e){d=!1,c.setCoords(),b(),h.trigger("object:added",{target:c}),a.getSocket().emit("object:added",c.toJSON(["id"]))})},k.addCircle=function(){var c,d,e,f;b(),h.on("mouse:down",function(a){h.selection=!1,d=!0;var b=h.getPointer(a.e);e=b.x,f=b.y,c=new fabric.Circle({left:b.x,top:b.y,radius:1,fill:"rgba(0,0,0,0)",stroke:h.freeDrawingBrush.color,strokeWidth:2,originX:"center",originY:"center",id:k.generateId()}),h.add(c)}),h.on("mouse:move",function(a){if(d){var b=h.getPointer(a.e);c.set({radius:Math.abs(e-b.x)}),h.renderAll()}}),h.on("mouse:up",function(e){d=!1,c.setCoords(),b(),h.trigger("object:added",{target:c}),a.getSocket().emit("object:added",c.toJSON(["id"]))})},k.clearCanvas=function(){h.clear().renderAll(),f()},k.eraser=function(){b(),h.on("object:selected",function(){h.getActiveGroup()?(h.getActiveGroup().forEachObject(function(a){h.remove(a)}),h.discardActiveGroup().renderAll()):h.remove(h.getActiveObject())})},k.addImage=function(c){b();new fabric.Image.fromURL(c,function(b){console.log("Image loaded.  Adding to canvas."),new fabric.Image(b).set({left:100,top:100,padding:10,cornersize:10,selectable:!0}),b.scaleToWidth(200),b.scaleToHeight(200),b.id=k.generateId(),h.add(b),a.getSocket().emit("object:added",b.toJSON(["id"])),h.renderAll()},{crossOrigin:"Anonymous"})},prortc.on("add_text",function(a){var b=new fabric.Textbox(a.text,{left:a.left,top:a.top,width:a.width,height:a.height,fill:a.fill});b.id=a.id,console.log(b),h.add(b),h.renderAll()}),prortc.on("object:added",function(a){switch(console.log("object added",a),a.type){case"textbox":var b=new fabric.Textbox(a.text,a);h.add(b);break;case"circle":var c=new fabric.Circle(a);h.add(c);break;case"line":var d=new fabric.Line([a.x1,a.y1,a.x2,a.y2],a);h.add(d);break;case"triangle":var e=new fabric.Triangle(a);h.add(e);break;case"rect":var f=new fabric.Rect(a);h.add(f);break;case"image":new fabric.Image.fromURL(a.src,function(b){console.log("Image loaded.  Adding to canvas."),new fabric.Image(b).set(a),b.id=a.id,b.scaleToWidth(200),b.scaleToHeight(200),h.add(b),h.renderAll()},{crossOrigin:"Anonymous"})}h.renderAll(),m?k.setSelectable(!0):k.setSelectable(!1),h.forEachObject(function(a){a.selectable=m}),h.selectable=m,h.renderAll()}),prortc.on("object:modified",function(a){var b=g(a.id);b&&(console.log("object:modified data ",a),b.animate({left:a.left,top:a.top,scaleX:a.scaleX,scaleY:a.scaleY,angle:a.angle},{duration:500,onChange:function(){"textbox"===a.type&&(b.text=a.text),b.id=a.id,b.setCoords(),h.renderAll(),m?k.setSelectable(!0):k.setSelectable(!1),h.forEachObject(function(a){a.selectable=m}),h.selectable=m,h.renderAll()},onComplete:function(){}}))}),prortc.on("object:removed",function(a){var b=g(a.id);b&&(console.log("object:removed data ",a),h.remove(b),h.renderAll())}),prortc.on("path:created",function(a){console.log("path:created ",a);for(var b=a.path.length,c=[],d=0;d<b;d++)for(var e=a.path[d],f=e.length,g=0;g<f;g++)c.push(e[g]);var i=new fabric.Path(c.join(" "),a);h.add(i),m?k.setSelectable(!0):k.setSelectable(!1),h.forEachObject(function(a){a.selectable=m}),h.selectable=m,h.renderAll()})}angular.module("suli.whiteboard").service("WhiteBoardService",["WebrtcService",a])}(),function(){"use strict";angular.module("suli.whiteboard").controller("WhiteBoardController",["$scope","$rootScope","WhiteBoardService","$http",function(a,b,c,d){c.init("whiteboard"),prortc.on("tutor_switch_whiteboard",function(a){a.allowStudent?(angular.element("#canvasTool").hide(),angular.element("#minTool").hide(),c.setWritable(!1)):(angular.element("#canvasTool").show(),c.getMinimize()?angular.element("#minTool").show():angular.element("#minTool").hide(),c.setWritable(!0)),c.setSelectable(!a.allowStudent)}),a.getChat=function(){angular.element(window).resize(function(){var a=angular.element("#VideoStreaming").outerHeight(!0)+angular.element("#SidebarTool").outerHeight(!0)+angular.element("#panel-heading").outerHeight(!0)+angular.element("#panel-footer").outerHeight(!0),b=angular.element(window).height();angular.element("#MessageList").css("height",b-a)}).resize()},a.getChat(),a.showTools=function(){angular.element("#canvasTool").toggle()},c.getCanvas()||c.init(),a.getCanvas=function(){angular.element(window).resize(function(){var a=angular.element(window).height(),b=angular.element("#LogoDiv").outerHeight(!0),d=a-b-10,e=angular.element(window).width();if(screen.width>767){var f=angular.element("#sidebar").width()+angular.element("#canvasTool").width(),g=e-f;c.setSize(g,d,g/d)}else{var g=e;c.setSize(g,d)}}).resize()},a.getCanvas(),prortc.on("allow_student",function(a){console.log("allow student",c.getMinimize()),a.allowStudent?(c.setSelectable(!0),c.setWritable(!0),angular.element("#canvasTool").show(),c.getMinimize()?angular.element("#minTool").show():angular.element("#minTool").hide()):(c.setSelectable(!1),c.setWritable(!1),angular.element("#canvasTool").hide(),angular.element("#minTool").hide())}),prortc.on("whiteboard",function(a){c.setRemoteStates(a)}),a.hideTools=function(){angular.element("#whiteboardScreen.full-screen #canvasTool, #whiteboardCanvas.explore #canvasTool").hide(),screen.width<767&&angular.element("#canvasTool").hide()},a.addText=function(){c.addText("Text..."),a.hideTools()},a.undo=function(){c.undo(),a.hideTools()},a.redo=function(b){c.redo(),a.hideTools()},a.changeColor=function(b){c.changeColor(b),a.hideTools()},a.addPen=function(){c.enableDrawing(1),a.hideTools()},a.addPencil=function(){c.enableDrawing(3),a.hideTools()},a.addHeighlighter=function(){c.enableDrawing(20),a.hideTools()},a.selectTool=function(){c.selectTool(),a.hideTools()},a.addLine=function(){c.addLine(),a.hideTools()},a.addSquare=function(){c.addSquare(),a.hideTools()},a.addTriangle=function(){c.addTriangle(),a.hideTools()},a.addCircle=function(){c.addCircle(),a.hideTools()},a.clearCanvas=function(){confirm("Are you sure want to clear canvas?")&&c.clearCanvas()},a.eraser=function(){c.eraser(),a.hideTools()},a.selectImage=function(b){angular.element("#image").click(),a.hideTools()},a.addImage=function(a){var b=document.getElementById("image").value,e=b.lastIndexOf(".")+1,f=b.substr(e,b.length).toLowerCase();if("jpg"==f||"jpeg"==f||"png"==f){var g=new FormData;g.append("file",a.files[0]),d.post("https://suli.prortc.com/upload",g,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(a){if(a.data.success){var b="https://suli.prortc.com/"+a.data.filePath;c.addImage(b)}},function(a){console.log("File upload error->",a)})}else alert("Only jpg/jpeg and png files are allowed!")}}])}(),function(){"use strict";angular.module("suli.main",["ui.router","suli.whiteboard"])}(),function(){"use strict";function a(a){this.saveLog=function(b){return a.post("https://suli.prortc.com/log",b)}}angular.module("suli.main").service("ApiService",["$http",a])}(),function(){"use strict";angular.module("suli.main").controller("MainController",["$scope","$rootScope","$location","WhiteBoardService","ApiService",function(a,b,c,d,e){function f(){d.getWritable()?(d.getMinimize()?angular.element("#minTool").show():angular.element("#minTool").hide(),angular.element("#canvasTool").show()):angular.element("#canvasTool").hide()}function g(a){e.saveLog(a)}var h=c.search();if(angular.element("#readyPopup").modal("hide"),a.expandVideo=function(){angular.element("#sidebar").addClass("siderbar-explore"),angular.element("#SideChat").hide(),angular.element(window).resize(function(){var a=angular.element("#heading").outerHeight(!0)+angular.element("#timeDiv").outerHeight(!0)+angular.element("#SidebarTool").outerHeight(!0),b=angular.element(window).height();angular.element("#local , #remote").css("height",b-a)}).resize()},a.minVideo=function(){angular.element("#sidebar").removeClass("siderbar-explore"),angular.element("#SideChat").show(),angular.element(window).resize(function(){var a=angular.element(window).height();angular.element("#local , #remote").removeAttr("style");var b=angular.element("#VideoStreaming").outerHeight(!0)+angular.element("#SidebarTool").outerHeight(!0)+angular.element("#panel-heading").outerHeight(!0)+angular.element("#panel-footer").outerHeight(!0);angular.element("#MessageList").css("height",a-b)}).resize()},a.expandChating=function(){angular.element(window).resize(function(){var a=angular.element(window).height(),b=angular.element(window).width(),c=angular.element(".whiteboard-screen").find("#sidebar").width(),d=angular.element("#panel-heading").outerHeight(!0)+angular.element("#panel-footer").outerHeight(!0);angular.element("#sidebar").addClass("explore-sidebar"),f(),angular.element("#MessageList").css("height",a-d),angular.element("#SideChat").addClass("explore-chat").css("width",b-c),angular.element("#whiteboardCanvas").addClass("explore")}).resize()},a.expandWhiteboard=function(){angular.element("#whiteboardCanvas").removeClass("explore"),angular.element(window).resize(function(){var a=angular.element(window).height(),b=angular.element("#LogoDiv").outerHeight(!0),c=a-b-10,e=angular.element(window).width(),f=angular.element("#sidebar").width()+angular.element("#canvasTool").width();angular.element("#CanvasMain").removeAttr("style");var g=e-f;d.setSize(g,c)}).resize()},a.miniWhiteboard=function(){angular.element(window).resize(function(){var a=(angular.element(window).width(),angular.element(window).height()),b=$("#whiteboardScreen").find("#local").width(),c=angular.element("#VideoStreaming").outerHeight(!0)+angular.element("#SidebarTool").outerHeight(!0)+30,e=angular.element("#VideoStreaming").outerHeight(!0)+angular.element("#SidebarTool").outerHeight(!0)+angular.element("#canvas-heading").outerHeight(!0),f=a-e-30;angular.element("#CanvasMain").css("height",a-c),angular.element("#CanvasMain").css("width",b),d.setSize(b,f)}).resize()},a.resizeWhiteboard=function(){angular.element(window).resize(function(){var a=(angular.element(window).width(),angular.element(window).height()),b=$("#whiteboardScreen").find("#local").width(),c=angular.element("#local").outerHeight(!0)+60,e=angular.element("#local").outerHeight(!0),f=a-e-120;angular.element("#CanvasMain").css("height",a-c),angular.element("#CanvasMain").css("width",b),d.setSize(b,f)}).resize()},a.minChating=function(){angular.element(window).resize(function(){var a=angular.element(window).height(),b=angular.element("#VideoStreaming").outerHeight(!0)+angular.element("#SidebarTool").outerHeight(!0)+angular.element("#panel-heading").outerHeight(!0)+angular.element("#panel-footer").outerHeight(!0);angular.element("#SideChat").removeClass("explore-chat").css("width",""),angular.element("#whiteboardCanvas").removeClass("explore"),angular.element("#MessageList").css("height",a-b)}).resize()},a.fullScreenVideo=function(){angular.element("#whiteboardScreen").addClass("full-screen"),angular.element("#whiteboardCanvas").addClass("explore"),angular.element("#SideChat").hide(),angular.element(window).resize(function(){var a=angular.element("#SidebarTool").outerHeight(!0),b=angular.element(window).height();angular.element("#remote").css("height",b-a-50)}).resize()},a.closefullScreenVideo=function(){angular.element("#whiteboardScreen").removeClass("full-screen"),angular.element("#SideChat").show(),angular.element(window).resize(function(){angular.element("#remote").removeAttr("style")}).resize()},a.fullScreen=function(){a.fullScreenVideo(),a.resizeWhiteboard(),d.setMinimize(!0),f()},a.closefullScreen=function(){a.closefullScreenVideo(),a.expandWhiteboard(),a.minChating(),d.setMinimize(!1),f()},a.exploreChat=function(){a.expandChating(),a.miniWhiteboard(),d.setMinimize(!0),f()},a.closeChat=function(){a.minChating(),a.expandWhiteboard(),d.setMinimize(!1),f()},a.exploreVideo=function(){a.expandVideo()},a.closeVideo=function(){a.minVideo(),a.minChating(),a.expandWhiteboard(),d.setMinimize(!1),f()},a.saveWhiteboard=function(){var a=document.createElement("a");a.href=d.getCanvas().toDataURL("png"),a.download="image.png",document.body.appendChild(a),a.click(),a.remove()},a.extendedTime=0,a.noOfCourses=1,a.extendTimeList=[{value:300,text:"5 minutes"},{value:600,text:"10 minutes"},{value:900,text:"15 minutes"}],a.exploreChat=function(){a.expandChating(),a.miniWhiteboard(),d.setMinimize(!0),f()},a.closeChat=function(){a.minChating(),a.expandWhiteboard(),d.setMinimize(!1)},a.exploreWhiteboard=function(){a.minChating(),a.expandWhiteboard(),d.setMinimize(!1),f()},h.room&&h.role)if("tutor"===h.role||"student"===h.role){if("tutor"===h.role){var i={role:"Tutor",event:"Entered Classroom",class_room_id:h.room};g(i),angular.element("#readyCoursePopup").modal("show")}if("student"===h.role){var i={role:"Student",event:"Entered Classroom",class_room_id:h.room};g(i),angular.element("#readyPopup").modal("show")}}else angular.element("#invalidRole").modal("show");else angular.element("#invalidUrl").modal("show");getUserMedia||(angular.element("#readyCoursePopup").modal("hide"),angular.element("#readyPopup").modal("hide"),angular.element("#webrtcNotSupport").modal("show")),a.incrementCourse=function(){a.noOfCourses>0&&a.noOfCourses<6&&a.noOfCourses++},a.decrementCourse=function(){a.noOfCourses>1&&a.noOfCourses--},a.startCall=function(){if(h.room&&h.role){if("tutor"===h.role&&a.noOfCourses>0){prortc.emit("start_call",{role:h.role,room:h.room,noOfCourses:a.noOfCourses}),angular.element("#readyCoursePopup").modal("hide");var b={role:"Tutor",event:"Approved to start the course",class_room_id:h.room};g(b)}if("student"===h.role){prortc.emit("start_call",h),angular.element("#readyPopup").modal("hide"),angular.element("#mini_toolsDiv").hide(),angular.element("#allowTools").hide(),angular.element("#canvasTool").hide(),angular.element("#minTool").hide(),d.setWritable(!1);var b={role:"Student",event:"Approved to start the course",class_room_id:h.room};g(b)}}},prortc.on("connections",function(a){0===a.length&&("tutor"===prortc.userRole&&angular.element("#waitingStudent").modal("show"),"student"===prortc.userRole&&angular.element("#waitingTutor").modal("show"))}),prortc.on("webrtc_not_support",function(){angular.element("#readyCoursePopup").modal("hide"),angular.element("#readyPopup").modal("hide"),angular.element("#webrtcNotSupport").modal("show")}),prortc.on("media_device_error",function(a){angular.element("#readyCoursePopup").modal("hide"),angular.element("#readyPopup").modal("hide")}),prortc.on("new_peer",function(a){"tutor"===prortc.userRole&&angular.element("#waitingStudent").modal("hide"),"student"===prortc.userRole&&(prortc.emit("update_course",a),angular.element("#waitingTutor").modal("hide")),prortc.socket.emit("start_timer"),prortc.emit("start_timer"),g({role:"Software",event:"Lession started",class_room_id:h.room})}),a.saveWhiteboard=function(){var a=document.createElement("a");a.href=d.getCanvas().toDataURL({format:"jpeg"}),a.download="image.jpeg",document.body.appendChild(a),a.click(),a.remove()},prortc.on("course_ended",function(){angular.element("#endedSession").modal("show"),angular.element("#endSession").modal("hide"),d.clearCanvas()}),a.$on("user_left",function(){var a={event:"Left classroom",class_room_id:h.room};"tutor"===h.role&&(a.role="Student",g(a)),"student"===h.role&&(a.role="Tutor",g(a))}),prortc.on("room_full",function(){angular.element("#roomFull").modal("show")}),a.endCourse=function(){angular.element("#endSession").modal("show")},a.endSession=function(){prortc.endCall(),d.clearCanvas(),angular.element("#endSession").modal("hide"),angular.element("#endedSession").modal("show"),g({role:"Software",event:"Lession ended",class_room_id:h.room})},a.cancelEndSession=function(){angular.element("#endSession").modal("hide")},a.extendTime=function(){a.extendedTime>0&&(prortc.socket.emit("extend_time",{time:a.extendedTime}),angular.element("#extendTimePopup").modal("hide"),a.extendedTime=0)},prortc.on("extend_time",function(b){angular.element("#confirmExtendSession").modal("show"),a.extendedTime=parseInt(b.message.time,10)}),a.confirmExtendSession=function(){angular.element("#confirmExtendSession").modal("hide"),prortc.socket.emit("extend_time_accepted",{time:a.extendedTime}),prortc.emit("extend_my_time",{time:a.extendedTime}),a.extendedTime=0},a.rejectExtendSession=function(){angular.element("#confirmExtendSession").modal("hide")},a.clearWhiteboard=function(){d.clearCanvas(),angular.element("#clearWhiteboard").modal("hide")},a.cancelClearWhiteboard=function(){angular.element("#clearWhiteboard").modal("hide")}}])}();